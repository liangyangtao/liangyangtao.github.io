---
layout: post
title: 网络爬虫（一）【基本概念】
category: 网络爬虫
date: 2014-12-26
---

标签： 网络爬虫 信息采集

<!-- more -->

## 1什么是网络爬虫
   【网络爬虫】（又被称为网页蜘蛛），是一种按照一定的规则，自动的抓取万维网信息的程序或者脚本，也叫信息采集系统。按照不同的用途又可分为传统爬虫和聚焦爬虫。
   【传统爬虫】从一个或若干初始网页的URL开始，获得初始网页上的URL，在抓取网页的过程中，不断从当前页面上抽取新的URL放入队列,直到满足系统的一定停止条件，一般百度、谷歌等搜索引擎的爬虫就这类。
   【聚焦爬虫】的工作流程较为复杂，需要根据一定的网页分析算法过滤与主题无关的链接，保留有用的链接并将其放入等待抓取的URL队列。很多不成熟的聚焦爬虫一般都有人为干预过滤无关链接，目前市面上见到的还没有那么智能。
## 2网络爬虫的作用
   将互联网上通过web途径公开的资源采集复制到本地磁盘。
   将非结构化的信息抽取出来保存到结构化的数据库中。
## 3什么地方使用网络爬虫
   1.传统搜索引擎，使用爬虫采集网站内容。
   2.在网上进行自动秒杀、购买、投票、发帖、发邮件等。
   3.企业定制版爬虫，他们主要是想获取别人网站的信息和资讯来实现他们业务。
   比如采集别的门户网站的新闻作为自己的网站的新闻，这个很普遍，查看大部分的新闻网站都是你转我的，我抄你的。
   采集一些电商数据，预测商品价格走势，采集一些股票数据、彩票数据等预测可以挣钱的几率。
   帮助繁忙的人定制他关心的资讯及时推送给他，他就无需再互联网中自己寻找这类新闻。
## 4优秀爬虫的特性
### 4.1高效性
   互联网的网页数量巨大，爬虫性能至关重要，常用的评价方式是单位时间能下载的数据量越多，爬虫性能越好，爬虫的调度策略、对磁盘操作方法、数据结构的设计对爬虫性能影响巨大。个人认为调度策略是一个爬虫的关键。
### 4.2可扩展
   爬虫应该有很好的扩展性，能够通过增加抓取服务器和爬虫数量来缩短采集周期。目前实用的大型网络爬虫一定是分布式运行的，即多台服务器专门做抓取，每台服务器部署多个爬虫，每个爬虫多线程运行，通过多种方式增加并发性。
### 4.3健壮性
   爬虫一定是一个长期一直运行的，能够处理各种异常，如果在采集过程中死掉或者停止工作，这是无法忍受的。如果由于服务器宕机，应该能够恢复之前抓取的内容和数据，记录采集位置，而不是每次都要从头开始采集。
### 4.4时效性
   有些业务需要爬虫要有高的时效性，要求在原始网站发布后的短时间内进行处理。比如股票信息等。
### 4.5友好性
   爬虫尽量不要给目标服务器带来压力，减少目标服务器的网络负载，尤其一些小的网站。robot协议的话，根据业务需要看着办吧（一般垂直爬虫大多不会遵守的）。
### 4.6准确性
   尽量采集与业务相关的网页内容，抽取网页内容尽量不要残带杂质。
## 5采集策略
### 5.1广度优先（宽度）
   这种方式用的比较多，原理简单，采集到的网页重要度和相关度都很高，注意深度控制，一般3到4层为好。
### 5.2深度优先
   这种方式适合哪种采集有层级关系的网页，比如采集国家统计局的数据， 山西 - 太原- 迎泽-.....
### 5.3非完全PageRank
  google 的链接分析算法，来衡量网页重要性。不推荐使用，pageRank 是全局算法，当所有网页下载完成后，计算结果才准确，单爬虫在下载的过程中只能看到部分页面，在采集阶段是无法获得可靠的PageRank的。
      非完全PageRank 和完整的PageRank 计算结果差异很大。看个人业务选择。
### 5.4其它
## 6更新策略
### 6.1历史参考策略
  一般采用泊松过程对网页变化进行建模，更加每个网页过去的变动情况，利用模型预测将来何时内容会发生变化。注意建模时应该去除广告或导航这种区域的变化。
### 6.2其它
## 7爬虫基本流程
### 7.1 爬虫结构
  1) 调度器  scheduler 包含种子队列、任务队列、过滤队列等，（调度策略一定要好）。
  2) 下载器  fetcher 将网页下载下来
  3) 解析器  parser 分析网页，抽取出需要消息、新的链接
  4) 存储器  storer  将抽取需要消息存储起来
### 7.2基本流程 
1) Scheduler启动爬虫器，TaskMaster初始化taskQueue
2) Workers从TaskQueue中获取任务
3) Worker线程调用Fetcher爬取Task中描述的网页
4) Worker线程将爬取到的网页交给Parser解析
5) Parser解析出来的数据送交Handler处理，抽取网页Link和处理网页内容
6) VisitedTableManager判断从URLExtractor抽取出来的链接是否已经被爬取过，如果没有提交到TaskQueue中
## 8爬虫架构
### 8.1采集系统基本架构

整个框架应该包含以下部分，资源管理、反监控管理、抓取管理、监控管理。看一下整个框架的架构图：

![采集系统疾病架构](/res/img/blogimg/webSpider/2015010101.jpg)


 
### 8.2主从式分布式架构
  这中架构中，有一台中央处理器负责对其它服务器进行分发任务，他维护抓取队列，其它机器进行下载任务，各个下载的服务器之间没有通信联系，他们只和中央处理器进行消息传递。
  这种架构的缺点是中央处理器在队列很大的时候，容易成为系统的瓶颈。

### 8.3对等式分布式架构
  这种架构服务器不存在分工差异，每个服务器功能相同，各自负责一部分URL抓取工作。任务的分发由自己判断。
  （1） 将网址的host进行哈希计算之后取模（hash（网址host）/m），除数m为服务器的个数，计算的值和服务器编号匹配上就行，如果匹配上就自己下载，如果匹配不上，把网址发到对应编号的服务器。
   这种方式的的m是固定的，若一台机器宕机，则取模为他的编号的网址则不会被下载。即便m可变，其它机器取模计算也得重新计算，浪费资源。
  （2） 一致性hash算法，即将网站的host进行hash，映射到一个范围在0到2^23之间的某个数值，大量的host会均匀的哈希到这个数值区间。
  
  
  
   







